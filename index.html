<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Regional Weather Intensity Score</title>
<style>
body { font-family: Arial, sans-serif; background:#0d1117; color:white; text-align:center; }
h1 { margin-top:20px; }
#score { font-size:80px; font-weight:700; margin:20px 0; }
#category { font-size:28px; margin-bottom:30px; font-weight:600; }
#chart { width:80%; height:200px; margin:0 auto; }
</style>
</head>
<body>

<h1>Regional Weather Intensity Score</h1>
<div id="score">--</div>
<div id="category">Loading...</div>

<canvas id="chart"></canvas>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
const box = {
  top: 62.58,
  left: 49.42,
  bottom: 37.12,
  right: 37.28
};

// Generate sample points (5x5 grid = 25 locations)
const points = [];
for (let i = 0; i < 5; i++) {
  for (let j = 0; j < 5; j++) {
    points.push({
      lat: box.top - i * ((box.top - box.bottom) / 4),
      lon: box.left - j * ((box.left - box.right) / 4)
    });
  }
}

let chart = new Chart(document.getElementById("chart"), {
  type: 'line',
  data: { labels: [], datasets: [{ data: [] }] },
  options: { responsive: true, plugins: { legend: { display:false } } }
});

async function fetchPointScore(lat, lon) {
  const url = `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&hourly=wind_speed_10m,precipitation,pressure_msl`;
  const r = await fetch(url);
  const d = await r.json();
  const i = d.hourly.time.length - 1;

  let wind_kmh = d.hourly.wind_speed_10m[i] * 3.6;
  let rain = d.hourly.precipitation[i];
  let pressure = d.hourly.pressure_msl[i];

  return (wind_kmh * 1.2) + (rain * 4) + ((1015 - pressure) * 0.8);
}

async function updateScore() {
  let scores = await Promise.all(points.map(p => fetchPointScore(p.lat, p.lon)));
  let score = Math.max(0, Math.round(scores.reduce((a,b)=>a+b,0) / scores.length));

  document.getElementById("score").textContent = score;

  let cat = "Quiet", color = "#4DB6FF";
  if (score > 30) { cat="Unsettled"; color="#00E676"; }
  if (score > 60) { cat="Active"; color="#FFB300"; }
  if (score > 90) { cat="Strong Storm"; color="#FB8C00"; }
  if (score > 130) { cat="Severe"; color="#E53935"; }
  if (score > 170) { cat="EXTREME"; color="#7B1FA2"; }

  document.getElementById("category").textContent = cat;
  document.getElementById("score").style.color = color;

  let t = new Date().toLocaleTimeString();
  chart.data.labels.push(t);
  chart.data.datasets[0].data.push(score);
  if (chart.data.labels.length > 20) {
    chart.data.labels.shift();
    chart.data.datasets[0].data.shift();
  }
  chart.update();
}

updateScore();
setInterval(updateScore, 5*60*1000);
</script>

</body>
</html>
